Example authenticate transaction
================================

The following transaction was captured with Chrome, Security Key NFC by Yubico
and Qubes CTAP proxy between them. This was the communication between the proxy
and the actual token.

The first field is timestamp (second and microsecond), the second one is the
device bus, number and endpoint, the third one is direction (``O`` is outgoing
from host, to token). Then CTAP HID packet data follows.

First field in the packet is channel ID. Channel ``ffffffff`` (-1) is the
broadcast channel which is only used for allocating other channel.

Second field is cmd/seq octet. If most significant bit is set (``8?``), this is
an init packet (in the CTAPHID transport layer meaning, not to be confused with
CTAPHID channel init, which is itself a command), and the octet is a CTAPHID
command. If the bit is not set, this is a continuation packet containing what
didn't fit in the length of previous init packet and the octet is a sequence
number.

If this is an init packet, the next field is bcnt, which encodes total length of
the payload, which could be split over several packets.

The rest is payload of the command.

The response (``I``) has the same format, with matching channel ID and command.

.. code-block:: none
    :emphasize-lines: 6,9,15,18

    // PART (I)
    // Channel init and GetInfo
    35.490106 4:003:4 O ffffffff 86 0008 696d22f395076a5100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    35.493969 4:003:4 I ffffffff 86 0011 696d22f395076a513a9d5d38020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    35.495587 4:003:4 O 3a9d5d38 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    35.497947 4:003:4 I 3a9d5d38 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    35.499932 4:003:4 I 3a9d5d38  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    35.501918 4:003:4 I 3a9d5d38  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    35.503926 4:003:4 I 3a9d5d38  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // GetInfo x2
    35.504960 4:003:4 O 3a9d5d38 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    35.507947 4:003:4 I 3a9d5d38 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    35.509939 4:003:4 I 3a9d5d38  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    35.511927 4:003:4 I 3a9d5d38  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    35.513910 4:003:4 I 3a9d5d38  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000

    // PART (II)
    // Channel init and GetInfo
    36.009225 4:003:4 O ffffffff 86 0008 a8e9b05cc892184700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    36.011958 4:003:4 I ffffffff 86 0011 a8e9b05cc8921847da718141020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    36.013909 4:003:4 O da718141 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    36.017925 4:003:4 I da718141 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    36.019891 4:003:4 I da718141  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    36.021917 4:003:4 I da718141  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    36.023923 4:003:4 I da718141  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // authenticatorClientPIN
    36.025015 4:003:4 O da718141 90 0006 06a201020201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    36.027927 4:003:4 I da718141 90 0004 00a103080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

    // Channel init and GetInfo
    39.572087 4:003:4 O ffffffff 86 0008 75d6d4b41cd23d6f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    39.576497 4:003:4 I ffffffff 86 0011 75d6d4b41cd23d6f03dff513020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    39.578493 4:003:4 O 03dff513 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    39.581857 4:003:4 I 03dff513 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    39.583864 4:003:4 I 03dff513  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    39.585932 4:003:4 I 03dff513  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    39.587901 4:003:4 I 03dff513  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // authenticatorClientPIN
    39.588947 4:003:4 O 03dff513 90 0006 06a201020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    39.591887 4:003:4 I 03dff513 90 0051 00a101a5010203381820012158203963b6ef10f055776a019843a3ab43420e97f33a1c68750d8db6959ff198113b225820d3d4d039b6646afe
    39.593879 4:003:4 I 03dff513  00 8d33f8fa677e53d3897b09e21e0b25e7a3c93f9e39e20b790000000000000000000000000000000000000000000000000000000000000000000000

    // Channel init and GetInfo
    40.085102 4:003:4 O ffffffff 86 0008 7fe76230de21cf6800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.087929 4:003:4 I ffffffff 86 0011 7fe76230de21cf68fd46dde3020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.089961 4:003:4 O fd46dde3 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.093879 4:003:4 I fd46dde3 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    40.095855 4:003:4 I fd46dde3  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    40.097878 4:003:4 I fd46dde3  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    40.099884 4:003:4 I fd46dde3  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // authenticatorClientPIN
    40.100841 4:003:4 O fd46dde3 90 0078 06a40102020503a50102033818200121582009da842af406751c196b72aff03898c3b62b3e6d25d8424541ece3e86e2a5cdd22582032a9c92e
    40.101898 4:003:4 O fd46dde3  00 cac708dc9843ebbb12d31f80b826e821f5de6ad2cbe786f286a4ed3d0658208ea8f70170f19188cecbdfbd2eca25bac0f3f3efb711186e853221d3
    40.103954 4:003:4 O fd46dde3  01 93a527bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.185912 4:003:4 I fd46dde3 90 0035 00a1025830ff1695868cf98a1138c818d4a2ec583096f5c61a4281b0ef923f11fbde3676594b2a5bcd381f8c21515ae55d66c0879400000000

    // PART (III)
    // Channel init and GetInfo
    40.655119 4:003:4 O ffffffff 86 0008 21a1fa397cbb0dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.657882 4:003:4 I ffffffff 86 0011 21a1fa397cbb0dd0032658da020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.659651 4:003:4 O 032658da 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    40.663875 4:003:4 I 032658da 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    40.665852 4:003:4 I 032658da  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    40.667856 4:003:4 I 032658da  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    40.669868 4:003:4 I 032658da  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // authenticatorGetAssertion
    40.670903 4:003:4 O 032658da 90 009f 02a5016b776562617574686e2e696f025820eeaa8d6c5e07fe5db311820b15c69032ea6a31d9f634490a389e40798f9efc6a0381a262696458
    40.671929 4:003:4 O 032658da  00 30e22a259cd5c071ce21656bf0fdc96bb9a919ea2a3cb2472d856eb7e885ab13ea546cc0af49f1aabeee19174e09a02a3564747970656a7075626c
    40.674203 4:003:4 O 032658da  01 69632d6b657906582054a9683e95d158c5153d5ffc6fea10fa66fd20e30faf177d28a9df37e428a8ed070200000000000000000000000000000000
    40.887903 4:003:4 I 032658da bb 0001 020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    41.177937 4:003:4 I 032658da bb 0001 020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    41.467904 4:003:4 I 032658da bb 0001 020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    41.615886 4:003:4 I 032658da 90 00c8 00a401a26269645830e22a259cd5c071ce21656bf0fdc96bb9a919ea2a3cb2472d856eb7e885ab13ea546cc0af49f1aabeee19174e09a02a35
    41.617859 4:003:4 I 032658da  00 64747970656a7075626c69632d6b657902582574a6ea9213c99c2f74b22492b320cf40262a94c1a950a0397f29250b60841ef00500000003035848
    41.619833 4:003:4 I 032658da  01 30460221008265eea631ac875504b56e8cabb4cf6645d6caa4d219067558d0ba94c6720e300221008d202e9e6d8e721a58db92a4083782db95faa2
    41.621864 4:003:4 I 032658da  02 c86896d9ddf3c37976efb4fe2604a16269644663335a7a5a6700000000000000000000000000000000000000000000000000000000000000000000

    // Channel init and GetInfo
    28.432132 4:003:4 O ffffffff 86 0008 6f553fd109889a2c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    28.435476 4:003:4 I ffffffff 86 0011 6f553fd109889a2c49e91f8d020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    28.436469 4:003:4 O 49e91f8d 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    28.439621 4:003:4 I 49e91f8d 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    28.441536 4:003:4 I 49e91f8d  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    28.443495 4:003:4 I 49e91f8d  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    28.445474 4:003:4 I 49e91f8d  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000
    // GetInfo x2
    28.448028 4:003:4 O 49e91f8d 90 0001 040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    28.451588 4:003:4 I 49e91f8d 90 00cc 00ac0183665532465f5632684649444f5f325f306c4649444f5f325f315f50524502826b6372656450726f746563746b686d61632d73656372
    28.453515 4:003:4 I 49e91f8d  00 65740350149a20218ef6413396b881f8d5b7f1f504a562726bf5627570f564706c6174f469636c69656e7450696ef57563726564656e7469616c4d
    28.455539 4:003:4 I 49e91f8d  01 676d7450726576696577f5051904b00682020107080818800982636e6663637573620a82a263616c672664747970656a7075626c69632d6b6579a2
    28.457517 4:003:4 I 49e91f8d  02 63616c672764747970656a7075626c69632d6b65790d040e1a00050403000000000000000000000000000000000000000000000000000000000000

    // Channel init
    28.988111 4:003:4 O ffffffff 86 0008 568bf50e416b703400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    28.991491 4:003:4 I ffffffff 86 0011 568bf50e416b7034a5daf2b0020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    // Check if token was touched
    28.993076 4:003:4 O a5daf2b0 83 0049 000103000000407fcffb48aa47c6dccedbd025e6072f91190c06a2973fa6a766562743659fb81ec46cef82ad1b546477591d008b08759ec3e6
    28.993672 4:003:4 O a5daf2b0  00 d2ecb4f39474bfea6969925d03b7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    // Not yet.
    28.998203 4:003:4 I a5daf2b0 83 0002 698500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

    // Channel init
    29.731141 4:003:4 O ffffffff 86 0008 43180a0a31120f7e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    29.735538 4:003:4 I ffffffff 86 0011 43180a0a31120f7ec7f7d4e0020504030500000000000000000000000000000000000000000000000000000000000000000000000000000000
    // Check if token was touched
    29.737233 4:003:4 O c7f7d4e0 83 0049 000103000000407fcffb48aa47c6dccedbd025e6072f91190c06a2973fa6a766562743659fb81ec46cef82ad1b546477591d008b08759ec3e6
    29.739608 4:003:4 O c7f7d4e0  00 d2ecb4f39474bfea6969925d03b7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    // Success!
    30.058451 4:003:4 I c7f7d4e0 83 03a9 0504cfd36d78510300da23952150dc701b719d662b6ed7f8033930b6200b52fdedf768a37221c00fc62e66bd11d07574affa730a6c07d9577f
    30.059519 4:003:4 I c7f7d4e0  00 83186e1da28f02e60340017cf9e0cc5c4df9f0f5bb01f0f1613a779bdc3c8cca053ee6f237b132921ab22c31ac33a86dd6e9006099fc1249c44cb5
    30.061537 4:003:4 I c7f7d4e0  01 e31190ab252fe605f89bf9d32b9e14308202d9308201c1a003020102020900cebb4fc380cb69c0300d06092a864886f70d01010b0500302e312c30
    30.063561 4:003:4 I c7f7d4e0  02 2a0603550403132359756269636f2055324620526f6f742043412053657269616c203435373230303633313020170d313430383031303030303030
    30.065473 4:003:4 I c7f7d4e0  03 5a180f32303530303930343030303030305a306f310b300906035504061302534531123010060355040a0c0959756269636f204142312230200603
    30.067594 4:003:4 I c7f7d4e0  04 55040b0c1941757468656e74696361746f72204174746573746174696f6e3128302606035504030c1f59756269636f205532462045452053657269
    30.069486 4:003:4 I c7f7d4e0  05 616c20313132393239383839343059301306072a8648ce3d020106082a8648ce3d03010703420004ef935cbf7e1b6251ed7cf8704a522c25bb20a1
    30.071455 4:003:4 I c7f7d4e0  06 a33105d267b7e0400684d8eeb86b560f5debe68042daaa80c96802182b2a89df5b799475406c64d8ed30ea3386a38181307f3013060a2b06010401
    30.073483 4:003:4 I c7f7d4e0  07 82c40a0d0104050403050403302206092b0601040182c40a020415312e332e362e312e342e312e34313438322e312e313013060b2b0601040182e5
    30.075515 4:003:4 I c7f7d4e0  08 1c0201010404030204303021060b2b0601040182e51c01010404120410149a20218ef6413396b881f8d5b7f1f5300c0603551d130101ff04023000
    30.077511 4:003:4 I c7f7d4e0  09 300d06092a864886f70d01010b05000382010100460e1fd0b9b261d2c0162fbaa03ab27789456c49ef96a3768dfc68cd8410557090de79696cd723
    30.079462 4:003:4 I c7f7d4e0  0a cfdce99d7079e483c9ecf511b49a63ea678e28ea65e95f8b72db72d9bf4c6c9921373490205263dad324b5b12cbf0073d345ca8970e9f85bd789fb
    30.081525 4:003:4 I c7f7d4e0  0b 0a0fb75212665ead16ff43c44fbbf90d871613ac579d076583984fbf207ab90e5d67405b892ddc0811bd4e1772bdbecaf2203fc6c32b9ab5d291e7
    30.083585 4:003:4 I c7f7d4e0  0c 3cb9a0c1606574a27238b70b6abad261f8239a09326ca4a3e9244bc26efa53f51938328efa0a58d2e8aebe95e0cede726e91ce3f675704c0275814
    30.085529 4:003:4 I c7f7d4e0  0d 8de9a735cfcdd850931f553ff5cff2e8c2b49fd2c911bd7e3b4090998914169187f866e80230e1173045022100f2f89a552a5e90ad1f42acb22375
    30.087455 4:003:4 I c7f7d4e0  0e 7f445c62fc2c209fb8a466db03b0b0545d33022073038059b12a5c538fe3f760b2840497ab99ab4d8587282aea8d0e54119608b690000000000000

Explanation
-----------

The communication protocol can be divided into three parts:

(I) Obtaining information about the authenticator:

The first step involves initializing a channel between the client and
the authenticator (cmd ``86``). Before sending any request to the token,
the host (sys-usb) sends a CBOR request (cmd "90", line 3) that contains
a "GetInfo" request, which is common to all parts of the communication.

Next, the client sends a "GetInfo" request to obtain information about the token
and its supported features.

(II) Prompting the user for a PIN and sending it to the token:

This part of the protocol involves three request-response communications.
The client prompts the user for a PIN and sends it to the token.

(III) Sending a "GetAssertion" request and prompting the user to touch the token:

The client sends a "GetAssertion" CBOR request to the token,
followed by another "GetInfo" request. The client then sends a message
(cmd "83") to the token to ask if the user has touched the device.
The first response is a 2-byte message that contains only the (nominally error)
status word "6985", which indicates that the user has not yet touched
the button. After approximately 1 second, the host initializes another set
of channels and sends another authentication request. This time, the token
returns a successful response.
