Example authenticate transaction
================================

The following transaction was captured with Firefox, Yubikey 4 and Qubes U2F
proxy between them. This was the communication between the proxy and the actual
token.

The first field is timestamp (second and microsecond), the second one is the
device bus, number and endpoint, the third one is direction (``O`` is outgoing
from host, to token). Then U2F HID packet data follows.

First field in the packet is channel ID. Channel ``ffffffff`` (-1) is the
broadcast channel which is only used for allocating other channel.

Second field is cmd/seq octet. If most significant bit is set (``8?``), this is
an init packet (in the U2FHID transport layer meaning, not to be confused with
U2FHID channel init, which is itself a command), and the octet is a U2FHID
command. If the bit is not set, this is a continuation packet containing what
didn't fit in the length of previous init packet and the octet is a sequence
number.

If this is an init packet, the next field is bcnt, which encodes total length of
the payload, which could be split over several packets.

The rest is payload of the command.

The response (``I``) has the same format, with matching channel ID and command.

.. code-block:: none
    :emphasize-lines: 6,9,15,18

    41.354714 1:003:0 O ffffffff 86 0008 14f9cda8f6e827a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.355575 1:003:4 O ffffffff 86 0008 3763893f3e64409900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.358672 1:003:4 I ffffffff 86 0011 3763893f3e64409900090068020403040100000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.359452 1:003:4 O ffffffff 86 0008 1446379f2cff9cd600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.362688 1:003:4 I ffffffff 86 0011 1446379f2cff9cd600090069020403040100000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.362800 1:003:4 O 00090069 83 008a 000203000000814985b80028d4d250a03ef6a15bddea1b3b4f83a43d5b9ea938a3590151c08f5c55673b5138cc90d3b7f32bfdad6a38a8edd7
    43.364900 1:003:4 O 00090069 00  b355b77ab9792196f106d16ca312400dc8659acbe9f3791fb04bbc92526fb6a1f5c19821faed3408793e7b879bc04f3184f2b66c4b5c0ba3f386b7
    43.366893 1:003:4 O 00090069 01  2639cc5eb8b6ff52a61a6a4a177e23133391e285000000000000000000000000000000000000000000000000000000000000000000000000000000
    43.382675 1:003:4 I 00090069 83 0002 698500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    44.786663 1:003:0 O ffffffff 86 0008 a649b983dfaeee6b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.787665 1:003:4 O ffffffff 86 0008 15890bf030888de300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.790667 1:003:4 I ffffffff 86 0011 15890bf030888de30009006a020403040100000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.791815 1:003:4 O ffffffff 86 0008 d9c1bdf205eb616e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.794666 1:003:4 I ffffffff 86 0011 d9c1bdf205eb616e0009006b020403040100000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.795132 1:003:4 O 0009006b 83 008a 000203000000814985b80028d4d250a03ef6a15bddea1b3b4f83a43d5b9ea938a3590151c08f5c55673b5138cc90d3b7f32bfdad6a38a8edd7
    46.796867 1:003:4 O 0009006b 00  b355b77ab9792196f106d16ca312400dc8659acbe9f3791fb04bbc92526fb6a1f5c19821faed3408793e7b879bc04f3184f2b66c4b5c0ba3f386b7
    46.798935 1:003:4 O 0009006b 01  2639cc5eb8b6ff52a61a6a4a177e23133391e285000000000000000000000000000000000000000000000000000000000000000000000000000000
    46.886672 1:003:4 I 0009006b 83 004d 0100000026304402201c8b0758104b0c19a31741d0a6dd172e468193ac41557ec32455473943bc765f02203c6fa410008d44c48aa27bf42534
    46.888666 1:003:4 I 0009006b 00  cc7203343f2b8e6650a9b0a54be9209dd65a9000000000000000000000000000000000000000000000000000000000000000000000000000000000

Explanation
-----------

First, the host attempts to initialise a channel (cmd ``86``) (it does this
3 times, with 2 channels allocated, not sure why). Then it sends a U2F message
(``83``, line 6), which contains command APDU with authentication request. The
response (line 9) is 2-byte message, a response APDU with only the (nominally
error) status word ``6985``, which means user did not yet touched the button.
Three seconds later hosts initialises another set of channels and sends another
authentication request (line 15). This time the token returns a successful
response APDU (line 18), with status word ``9000``.
